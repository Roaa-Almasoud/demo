{"ast":null,"code":"import _classCallCheck from\"/Users/roaa/Desktop/demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/roaa/Desktop/demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/roaa/Desktop/demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/roaa/Desktop/demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import EventEmitter from'events';import*as THREE from'three';import browser from'browser-detect';import{passiveEvent}from'../../utils/event.utils.js';var InteractiveControls=/*#__PURE__*/function(_EventEmitter){_inherits(InteractiveControls,_EventEmitter);var _super=_createSuper(InteractiveControls);function InteractiveControls(camera,el){var _this;_classCallCheck(this,InteractiveControls);_this=_super.call(this);_this.camera=camera;_this.el=el||window;_this.plane=new THREE.Plane();_this.raycaster=new THREE.Raycaster();_this.mouse=new THREE.Vector2();_this.offset=new THREE.Vector3();_this.intersection=new THREE.Vector3();_this.objects=[];_this.hovered=null;_this.selected=null;_this.isDown=false;_this.browser=browser();_this.enable();return _this;}_createClass(InteractiveControls,[{key:\"enabled\",get:function get(){return this._enabled;}},{key:\"enable\",value:function enable(){if(this.enabled)return;this.addListeners();this._enabled=true;}},{key:\"disable\",value:function disable(){if(!this.enabled)return;this.removeListeners();this._enabled=false;}},{key:\"addListeners\",value:function addListeners(){this.handlerDown=this.onDown.bind(this);this.handlerMove=this.onMove.bind(this);this.handlerUp=this.onUp.bind(this);this.handlerLeave=this.onLeave.bind(this);if(this.browser.mobile){this.el.addEventListener('touchstart',this.handlerDown,passiveEvent);this.el.addEventListener('touchmove',this.handlerMove,passiveEvent);this.el.addEventListener('touchend',this.handlerUp,passiveEvent);}else{this.el.addEventListener('mousedown',this.handlerDown);this.el.addEventListener('mousemove',this.handlerMove);this.el.addEventListener('mouseup',this.handlerUp);this.el.addEventListener('mouseleave',this.handlerLeave);}}},{key:\"removeListeners\",value:function removeListeners(){if(this.browser.mobile){this.el.removeEventListener('touchstart',this.handlerDown);this.el.removeEventListener('touchmove',this.handlerMove);this.el.removeEventListener('touchend',this.handlerUp);}else{this.el.removeEventListener('mousedown',this.handlerDown);this.el.removeEventListener('mousemove',this.handlerMove);this.el.removeEventListener('mouseup',this.handlerUp);this.el.removeEventListener('mouseleave',this.handlerLeave);}}},{key:\"resize\",value:function resize(x,y,width,height){if(x||y||width||height){this.rect={x:x,y:y,width:width,height:height};}else if(this.el===window){this.rect={x:0,y:0,width:window.innerWidth,height:window.innerHeight};}else{this.rect=this.el.getBoundingClientRect();}}},{key:\"onMove\",value:function onMove(e){var t=e.touches?e.touches[0]:e;var touch={x:t.clientX,y:t.clientY};this.mouse.x=(touch.x+this.rect.x)/this.rect.width*2-1;this.mouse.y=-((touch.y+this.rect.y)/this.rect.height)*2+1;this.raycaster.setFromCamera(this.mouse,this.camera);/*\n\t\t// is dragging\n\t\tif (this.selected && this.isDown) {\n\t\t\tif (this.raycaster.ray.intersectPlane(this.plane, this.intersection)) {\n\t\t\t\tthis.emit('interactive-drag', { object: this.selected, position: this.intersection.sub(this.offset) });\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\t*/var intersects=this.raycaster.intersectObjects(this.objects);if(intersects.length>0){var object=intersects[0].object;this.intersectionData=intersects[0];this.plane.setFromNormalAndCoplanarPoint(this.camera.getWorldDirection(this.plane.normal),object.position);if(this.hovered!==object){this.emit('interactive-out',{object:this.hovered});this.emit('interactive-over',{object:object});this.hovered=object;}else{this.emit('interactive-move',{object:object,intersectionData:this.intersectionData});}}else{this.intersectionData=null;if(this.hovered!==null){this.emit('interactive-out',{object:this.hovered});this.hovered=null;}}}},{key:\"onDown\",value:function onDown(e){this.isDown=true;this.onMove(e);this.emit('interactive-down',{object:this.hovered,previous:this.selected,intersectionData:this.intersectionData});this.selected=this.hovered;if(this.selected){if(this.raycaster.ray.intersectPlane(this.plane,this.intersection)){this.offset.copy(this.intersection).sub(this.selected.position);}}}},{key:\"onUp\",value:function onUp(e){this.isDown=false;this.emit('interactive-up',{object:this.hovered});}},{key:\"onLeave\",value:function onLeave(e){this.onUp(e);this.emit('interactive-out',{object:this.hovered});this.hovered=null;}}]);return InteractiveControls;}(EventEmitter);export{InteractiveControls as default};","map":{"version":3,"sources":["/Users/roaa/Desktop/demo/src/scripts/webgl/controls/InteractiveControls.js"],"names":["EventEmitter","THREE","browser","passiveEvent","InteractiveControls","camera","el","window","plane","Plane","raycaster","Raycaster","mouse","Vector2","offset","Vector3","intersection","objects","hovered","selected","isDown","enable","_enabled","enabled","addListeners","removeListeners","handlerDown","onDown","bind","handlerMove","onMove","handlerUp","onUp","handlerLeave","onLeave","mobile","addEventListener","removeEventListener","x","y","width","height","rect","innerWidth","innerHeight","getBoundingClientRect","e","t","touches","touch","clientX","clientY","setFromCamera","intersects","intersectObjects","length","object","intersectionData","setFromNormalAndCoplanarPoint","getWorldDirection","normal","position","emit","previous","ray","intersectPlane","copy","sub"],"mappings":"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","sourcesContent":["import EventEmitter from 'events';\nimport * as THREE from 'three';\nimport browser from 'browser-detect';\n\nimport { passiveEvent } from '../../utils/event.utils.js';\n\nexport default class InteractiveControls extends EventEmitter {\n\n\tget enabled() { return this._enabled; }\n\n\tconstructor(camera, el) {\n\t\tsuper();\n\n\t\tthis.camera = camera;\n\t\tthis.el = el || window;\n\n\t\tthis.plane = new THREE.Plane();\n\t\tthis.raycaster = new THREE.Raycaster();\n\n\t\tthis.mouse = new THREE.Vector2();\n\t\tthis.offset = new THREE.Vector3();\n\t\tthis.intersection = new THREE.Vector3();\n\t\t\n\t\tthis.objects = [];\n\t\tthis.hovered = null;\n\t\tthis.selected = null;\n\n\t\tthis.isDown = false;\n\n\t\tthis.browser = browser();\n\n\t\tthis.enable();\n\t}\n\n\tenable() {\n\t\tif (this.enabled) return;\n\t\tthis.addListeners();\n\t\tthis._enabled = true;\n\t}\n\n\tdisable() {\n\t\tif (!this.enabled) return;\n\t\tthis.removeListeners();\n\t\tthis._enabled = false;\n\t}\n\n\taddListeners() {\n\t\tthis.handlerDown = this.onDown.bind(this);\n\t\tthis.handlerMove = this.onMove.bind(this);\n\t\tthis.handlerUp = this.onUp.bind(this);\n\t\tthis.handlerLeave = this.onLeave.bind(this);\n\n\t\tif (this.browser.mobile) {\n\t\t\tthis.el.addEventListener('touchstart', this.handlerDown, passiveEvent);\n\t\t\tthis.el.addEventListener('touchmove', this.handlerMove, passiveEvent);\n\t\t\tthis.el.addEventListener('touchend', this.handlerUp, passiveEvent);\n\t\t}\n\t\telse {\n\t\t\tthis.el.addEventListener('mousedown', this.handlerDown);\n\t\t\tthis.el.addEventListener('mousemove', this.handlerMove);\n\t\t\tthis.el.addEventListener('mouseup', this.handlerUp);\n\t\t\tthis.el.addEventListener('mouseleave', this.handlerLeave);\n\t\t}\n\t}\n\n\tremoveListeners() {\n\t\tif (this.browser.mobile) {\n\t\t\tthis.el.removeEventListener('touchstart', this.handlerDown);\n\t\t\tthis.el.removeEventListener('touchmove', this.handlerMove);\n\t\t\tthis.el.removeEventListener('touchend', this.handlerUp);\n\t\t}\n\t\telse {\n\t\t\tthis.el.removeEventListener('mousedown', this.handlerDown);\n\t\t\tthis.el.removeEventListener('mousemove', this.handlerMove);\n\t\t\tthis.el.removeEventListener('mouseup', this.handlerUp);\n\t\t\tthis.el.removeEventListener('mouseleave', this.handlerLeave);\n\t\t}\n\t}\n\n\tresize(x, y, width, height) {\n\t\tif (x || y || width || height) {\n\t\t\tthis.rect = { x, y, width, height };\n\t\t}\n\t\telse if (this.el === window) {\n\t\t\tthis.rect = { x: 0, y: 0, width: window.innerWidth, height: window.innerHeight };\n\t\t}\n\t\telse {\n\t\t\tthis.rect = this.el.getBoundingClientRect();\n\t\t}\n\t}\n\n\tonMove(e) {\n\t\tconst t = (e.touches) ? e.touches[0] : e;\n\t\tconst touch = { x: t.clientX, y: t.clientY };\n\n\t\tthis.mouse.x = ((touch.x + this.rect.x) / this.rect.width) * 2 - 1;\n\t\tthis.mouse.y = -((touch.y + this.rect.y) / this.rect.height) * 2 + 1;\n\n\t\tthis.raycaster.setFromCamera(this.mouse, this.camera);\n\n\t\t/*\n\t\t// is dragging\n\t\tif (this.selected && this.isDown) {\n\t\t\tif (this.raycaster.ray.intersectPlane(this.plane, this.intersection)) {\n\t\t\t\tthis.emit('interactive-drag', { object: this.selected, position: this.intersection.sub(this.offset) });\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\t*/\n\n\t\tconst intersects = this.raycaster.intersectObjects(this.objects);\n\n\t\tif (intersects.length > 0) {\n\t\t\tconst object = intersects[0].object;\n\t\t\tthis.intersectionData = intersects[0];\n\n\t\t\tthis.plane.setFromNormalAndCoplanarPoint(this.camera.getWorldDirection(this.plane.normal), object.position);\n\n\t\t\tif (this.hovered !== object) {\n\t\t\t\tthis.emit('interactive-out', { object: this.hovered });\n\t\t\t\tthis.emit('interactive-over', { object });\n\t\t\t\tthis.hovered = object;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.emit('interactive-move', { object, intersectionData: this.intersectionData });\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tthis.intersectionData = null;\n\n\t\t\tif (this.hovered !== null) {\n\t\t\t\tthis.emit('interactive-out', { object: this.hovered });\n\t\t\t\tthis.hovered = null;\n\t\t\t}\n\t\t}\n\t}\n\n\tonDown(e) {\n\t\tthis.isDown = true;\n\t\tthis.onMove(e);\n\n\t\tthis.emit('interactive-down', { object: this.hovered, previous: this.selected, intersectionData: this.intersectionData });\n\t\tthis.selected = this.hovered;\n\n\t\tif (this.selected) {\n\t\t\tif (this.raycaster.ray.intersectPlane(this.plane, this.intersection)) {\n\t\t\t\tthis.offset.copy(this.intersection).sub(this.selected.position);\n\t\t\t}\n\t\t}\n\t}\n\n\tonUp(e) {\n\t\tthis.isDown = false;\n\n\t\tthis.emit('interactive-up', { object: this.hovered });\n\t}\n\n\tonLeave(e) {\n\t\tthis.onUp(e);\n\t\t\n\t\tthis.emit('interactive-out', { object: this.hovered });\n\t\tthis.hovered = null;\n\t}\n}\n"]},"metadata":{},"sourceType":"module"}