{"ast":null,"code":"var ObjectComponent = require('../core/ObjectComponent');\n\nvar Node = require('../core/document/Node');\n\nvar CSS = require('../core/document/CSS');\n\nvar Options = require('./Options');\n\nvar History = require('../core/History');\n\nvar Event_ = require('../core/event/Event'),\n    NodeEvent = require('../core/document/NodeEvent'),\n    ComponentEvent = require('../core/ComponentEvent'),\n    OptionEvent = require('../core/OptionEvent');\n\nvar ObjectComponentNotifier = require('../core/ObjectComponentNotifier');\n\nvar STR_CHOOSE = 'Choose ...';\n\nfunction Select(parent, object, value, params) {\n  ObjectComponent.apply(this, arguments);\n  params = params || {};\n  params.onChange = params.onChange || this._onChange;\n  this._onChange = params.onChange;\n  var obj = this._obj,\n      key = this._key;\n  var targetKey = this._targetKey = params.target,\n      values = this._values = obj[key];\n  this._selectedIndex = -1;\n  this._selected = null;\n  var select = this._select = new Node(Node.INPUT_BUTTON);\n  select.setStyleClass(CSS.Select);\n  select.addEventListener(NodeEvent.MOUSE_DOWN, this._onOptionTrigger.bind(this));\n\n  if (this._hasTarget()) {\n    var targetObj = obj[targetKey] || '';\n    var i = -1;\n\n    while (++i < values.length) {\n      if (targetObj == values[i]) {\n        this._selected = values[i];\n      }\n    }\n\n    select.setProperty('value', targetObj.toString().length > 0 ? targetObj : values[0]);\n  } else {\n    select.setProperty('value', params.selected !== -1 ? values[params.selected] : STR_CHOOSE);\n  }\n\n  this._wrapNode.addChild(select);\n\n  ObjectComponentNotifier.get().addEventListener(OptionEvent.TRIGGER, this, 'onOptionTrigger');\n  this.addEventListener(OptionEvent.TRIGGERED, ObjectComponentNotifier.get(), 'onOptionTriggered');\n}\n\nSelect.prototype = Object.create(ObjectComponent.prototype);\nSelect.prototype.constructor = Select;\n\nSelect.prototype.onOptionTrigger = function (e) {\n  if (e.data.origin == this) {\n    this._active = !this._active;\n\n    this._updateAppearance();\n\n    if (this._active) {\n      this._buildOptions();\n    } else {\n      Options.get().clear();\n    }\n\n    return;\n  }\n\n  this._active = false;\n\n  this._updateAppearance();\n};\n\nSelect.prototype._buildOptions = function () {\n  var options = Options.get();\n  var self = this;\n  options.build(this._values, this._selected, this._select, function () {\n    self.applyValue();\n    self._active = false;\n\n    self._updateAppearance();\n\n    self._selectedIndex = options.getSelectedIndex();\n\n    self._onChange(self._selectedIndex);\n\n    options.clear();\n  }, function () {\n    self._active = false;\n\n    self._updateAppearance();\n\n    options.clear();\n  }, false);\n};\n\nSelect.prototype._applySelected = function (selected) {\n  this._select.setProperty('value', selected);\n\n  this.dispatchEvent(new Event_(this, ComponentEvent.VALUE_UPDATED), null);\n};\n\nSelect.prototype.applyValue = function () {\n  var index = Options.get().getSelectedIndex(),\n      selected = this._selected = this._values[index];\n\n  if (this._hasTarget()) {\n    this.pushHistoryState();\n    this._obj[this._targetKey] = selected;\n  }\n\n  this._applySelected(selected);\n};\n\nSelect.prototype.pushHistoryState = function () {\n  var obj = this._obj,\n      key = this._targetKey;\n  History.get().pushState(obj, key, obj[key]);\n};\n\nSelect.prototype._onOptionTrigger = function () {\n  this.dispatchEvent(new Event_(this, OptionEvent.TRIGGERED, null));\n};\n\nSelect.prototype._updateAppearance = function () {\n  this._select.setStyleClass(this._active ? CSS.SelectActive : CSS.Select);\n};\n\nSelect.prototype.onValueUpdate = function (e) {\n  if (!this._hasTarget()) {\n    return;\n  }\n\n  this._selected = this._obj[this._targetKey];\n\n  this._select.setProperty('value', this._selected.toString());\n};\n\nSelect.prototype._hasTarget = function () {\n  return this._targetKey != null;\n};\n\nSelect.prototype.setValue = function (value) {\n  this._selectedIndex = value;\n\n  if (value == -1) {\n    this._selected = null;\n\n    this._select.setProperty('value', STR_CHOOSE);\n\n    return;\n  }\n\n  this._selected = this._values[this._selectedIndex];\n\n  this._applySelected(this._selected);\n};\n\nSelect.prototype.getData = function () {\n  var obj = {};\n  obj['selectedIndex'] = this._selectedIndex;\n  return obj;\n};\n\nmodule.exports = Select;","map":{"version":3,"sources":["/Users/roaa/Desktop/demo/node_modules/@brunoimbrizi/controlkit/lib/component/Select.js"],"names":["ObjectComponent","require","Node","CSS","Options","History","Event_","NodeEvent","ComponentEvent","OptionEvent","ObjectComponentNotifier","STR_CHOOSE","Select","parent","object","value","params","apply","arguments","onChange","_onChange","obj","_obj","key","_key","targetKey","_targetKey","target","values","_values","_selectedIndex","_selected","select","_select","INPUT_BUTTON","setStyleClass","addEventListener","MOUSE_DOWN","_onOptionTrigger","bind","_hasTarget","targetObj","i","length","setProperty","toString","selected","_wrapNode","addChild","get","TRIGGER","TRIGGERED","prototype","Object","create","constructor","onOptionTrigger","e","data","origin","_active","_updateAppearance","_buildOptions","clear","options","self","build","applyValue","getSelectedIndex","_applySelected","dispatchEvent","VALUE_UPDATED","index","pushHistoryState","pushState","SelectActive","onValueUpdate","setValue","getData","module","exports"],"mappings":"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","sourcesContent":["var ObjectComponent = require('../core/ObjectComponent');\r\nvar Node = require('../core/document/Node');\r\nvar CSS  = require('../core/document/CSS');\r\n\r\nvar Options = require('./Options');\r\n\r\nvar History = require('../core/History');\r\n\r\nvar Event_         = require('../core/event/Event'),\r\n    NodeEvent      = require('../core/document/NodeEvent'),\r\n    ComponentEvent = require('../core/ComponentEvent'),\r\n    OptionEvent    = require('../core/OptionEvent');\r\n\r\nvar ObjectComponentNotifier = require('../core/ObjectComponentNotifier');\r\n\r\nvar STR_CHOOSE = 'Choose ...';\r\n\r\nfunction Select(parent, object, value, params) {\r\n    ObjectComponent.apply(this, arguments);\r\n\r\n    params = params || {};\r\n    params.onChange = params.onChange || this._onChange;\r\n    this._onChange = params.onChange;\r\n\r\n    var obj = this._obj,\r\n        key = this._key;\r\n\r\n    var targetKey = this._targetKey = params.target,\r\n        values = this._values = obj[key];\r\n\r\n\r\n    this._selectedIndex = -1;\r\n    this._selected = null;\r\n\r\n    var select = this._select = new Node(Node.INPUT_BUTTON);\r\n        select.setStyleClass(CSS.Select);\r\n        select.addEventListener(NodeEvent.MOUSE_DOWN, this._onOptionTrigger.bind(this));\r\n\r\n    if(this._hasTarget()) {\r\n        var targetObj = obj[targetKey] || '';\r\n        var i = -1;\r\n        while (++i < values.length) {\r\n            if (targetObj == values[i]){\r\n                this._selected = values[i];\r\n            }\r\n        }\r\n        select.setProperty('value', targetObj.toString().length > 0 ? targetObj : values[0]);\r\n    }\r\n    else {\r\n        select.setProperty('value', params.selected !== -1 ? values[params.selected] : STR_CHOOSE);\r\n    }\r\n\r\n    this._wrapNode.addChild(select);\r\n\r\n    ObjectComponentNotifier.get().addEventListener(OptionEvent.TRIGGER, this, 'onOptionTrigger');\r\n    this.addEventListener(OptionEvent.TRIGGERED, ObjectComponentNotifier.get(), 'onOptionTriggered');\r\n}\r\nSelect.prototype = Object.create(ObjectComponent.prototype);\r\nSelect.prototype.constructor = Select;\r\n\r\nSelect.prototype.onOptionTrigger = function (e) {\r\n    if (e.data.origin == this) {\r\n        this._active = !this._active;\r\n        this._updateAppearance();\r\n\r\n        if (this._active) {\r\n            this._buildOptions();\r\n        }\r\n        else {\r\n            Options.get().clear();\r\n        }\r\n        return;\r\n    }\r\n    this._active = false;\r\n    this._updateAppearance();\r\n};\r\n\r\nSelect.prototype._buildOptions = function () {\r\n    var options = Options.get();\r\n    var self = this;\r\n\r\n    options.build(this._values, this._selected, this._select,\r\n        function(){\r\n            self.applyValue();\r\n            self._active = false;\r\n            self._updateAppearance();\r\n            self._selectedIndex = options.getSelectedIndex();\r\n            self._onChange(self._selectedIndex);\r\n            options.clear();\r\n        },\r\n        function(){\r\n            self._active = false;\r\n            self._updateAppearance();\r\n            options.clear()\r\n        }, false);\r\n};\r\n\r\nSelect.prototype._applySelected = function(selected){\r\n    this._select.setProperty('value',selected);\r\n    this.dispatchEvent(new Event_(this,ComponentEvent.VALUE_UPDATED),null);\r\n}\r\n\r\nSelect.prototype.applyValue = function () {\r\n    var index = Options.get().getSelectedIndex(),\r\n        selected = this._selected = this._values[index];\r\n\r\n    if (this._hasTarget()) {\r\n        this.pushHistoryState();\r\n        this._obj[this._targetKey] = selected;\r\n    }\r\n\r\n    this._applySelected(selected);\r\n};\r\n\r\nSelect.prototype.pushHistoryState = function () {\r\n    var obj = this._obj,\r\n        key = this._targetKey;\r\n    History.get().pushState(obj, key, obj[key]);\r\n};\r\n\r\nSelect.prototype._onOptionTrigger = function () {\r\n    this.dispatchEvent(new Event_(this, OptionEvent.TRIGGERED, null));\r\n};\r\n\r\nSelect.prototype._updateAppearance = function () {\r\n    this._select.setStyleClass(this._active ? CSS.SelectActive : CSS.Select);\r\n};\r\n\r\nSelect.prototype.onValueUpdate = function (e) {\r\n    if (!this._hasTarget()){\r\n        return;\r\n    }\r\n    this._selected = this._obj[this._targetKey];\r\n    this._select.setProperty('value', this._selected.toString());\r\n};\r\n\r\nSelect.prototype._hasTarget = function () {\r\n    return this._targetKey != null;\r\n};\r\n\r\nSelect.prototype.setValue = function(value){\r\n    this._selectedIndex = value;\r\n    if(value == -1){\r\n        this._selected = null;\r\n        this._select.setProperty('value', STR_CHOOSE);\r\n        return;\r\n    }\r\n    this._selected = this._values[this._selectedIndex];\r\n    this._applySelected(this._selected);\r\n};\r\n\r\nSelect.prototype.getData = function(){\r\n    var obj = {};\r\n        obj['selectedIndex'] = this._selectedIndex;\r\n    return obj;\r\n};\r\n\r\nmodule.exports = Select;\r\n"]},"metadata":{},"sourceType":"script"}