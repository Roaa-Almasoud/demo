{"ast":null,"code":"var ObjectComponent = require('../core/ObjectComponent');\n\nvar Node = require('../core/document/Node');\n\nvar CSS = require('../core/document/CSS');\n\nvar Options = require('./Options');\n\nvar ButtonPreset = require('./ButtonPreset');\n\nvar Metric = require('./Metric');\n\nvar Event_ = require('../core/event/Event'),\n    DocumentEvent = require('../core/document/DocumentEvent'),\n    NodeEvent = require('../core/document/NodeEvent'),\n    ComponentEvent = require('../core/ComponentEvent');\n\nvar DEFAULT_PRESET = null;\n\nfunction StringInput(parent, object, value, params) {\n  ObjectComponent.apply(this, arguments);\n  params = params || {};\n  params.onChange = params.onChange || this._onChange;\n  params.presets = params.presets || DEFAULT_PRESET;\n  this._onChange = params.onChange;\n  var input = this._input = new Node(Node.INPUT_TEXT);\n  var wrap = this._wrapNode;\n  var presets = params.presets;\n\n  if (!presets) {\n    wrap.addChild(input);\n  } else {\n    var wrap_ = new Node();\n    wrap_.setStyleClass(CSS.WrapInputWPreset);\n    wrap.addChild(wrap_);\n    wrap_.addChild(input);\n    var options = Options.get(),\n        btnPreset = new ButtonPreset(this._wrapNode);\n\n    var onPresetDeactivate = function () {\n      options.clear();\n      btnPreset.deactivate();\n    };\n\n    var self = this;\n\n    var onPresetActivate = function () {\n      options.build(presets, input.getProperty('value'), input, function () {\n        input.setProperty('value', presets[options.getSelectedIndex()]);\n        self.pushHistoryState();\n        self.applyValue();\n      }, onPresetDeactivate, Metric.PADDING_PRESET, false);\n    };\n\n    btnPreset.setOnActive(onPresetActivate);\n    btnPreset.setOnDeactive(onPresetDeactivate);\n  }\n\n  input.setProperty('value', this._obj[this._key]);\n  input.addEventListener(NodeEvent.KEY_UP, this._onInputKeyUp.bind(this));\n  input.addEventListener(NodeEvent.CHANGE, this._onInputChange.bind(this));\n  input.addEventListener(NodeEvent.MOUSE_DOWN, this._onInputDragStart.bind(this));\n  this.addEventListener(ComponentEvent.INPUT_SELECT_DRAG, this._parent, 'onComponentSelectDrag');\n}\n\nStringInput.prototype = Object.create(ObjectComponent.prototype);\nStringInput.prototype.constructor = StringInput;\n\nStringInput.prototype._onInputKeyUp = function (e) {\n  if (this._keyIsChar(e.keyCode)) {\n    this.pushHistoryState();\n  }\n\n  this.applyValue();\n\n  this._onChange();\n};\n\nStringInput.prototype._onInputChange = function (e) {\n  if (this._keyIsChar(e.keyCode)) {\n    this.pushHistoryState();\n  }\n\n  this.applyValue();\n}; //TODO: Finish check\n\n\nStringInput.prototype._keyIsChar = function (keyCode) {\n  return keyCode != 17 && keyCode != 18 && keyCode != 20 && keyCode != 37 && keyCode != 38 && keyCode != 39 && keyCode != 40 && keyCode != 16;\n};\n\nStringInput.prototype.applyValue = function () {\n  this._obj[this._key] = this._input.getProperty('value');\n  this.dispatchEvent(new Event_(this, ComponentEvent.VALUE_UPDATED, null));\n};\n\nStringInput.prototype.onValueUpdate = function (e) {\n  if (e.data.origin == this) return;\n\n  this._input.setProperty('value', this._obj[this._key]);\n}; //Prevent chrome select drag\n\n\nStringInput.prototype._onInputDragStart = function () {\n  var eventMove = DocumentEvent.MOUSE_MOVE,\n      eventUp = DocumentEvent.MOUSE_UP;\n  var event = ComponentEvent.INPUT_SELECT_DRAG;\n  var self = this;\n\n  var onDrag = function () {\n    self.dispatchEvent(new Event_(this, event, null));\n  },\n      onDragFinish = function () {\n    self.dispatchEvent(new Event_(this, event, null));\n    document.removeEventListener(eventMove, onDrag, false);\n    document.removeEventListener(eventMove, onDragFinish, false);\n  };\n\n  this.dispatchEvent(new Event_(this, event, null));\n  document.addEventListener(eventMove, onDrag, false);\n  document.addEventListener(eventUp, onDragFinish, false);\n};\n\nStringInput.prototype.update = function () {\n  this.onValueUpdate({\n    data: {}\n  });\n};\n\nmodule.exports = StringInput;","map":{"version":3,"sources":["/Users/roaa/Desktop/demo/node_modules/@brunoimbrizi/controlkit/lib/component/StringInput.js"],"names":["ObjectComponent","require","Node","CSS","Options","ButtonPreset","Metric","Event_","DocumentEvent","NodeEvent","ComponentEvent","DEFAULT_PRESET","StringInput","parent","object","value","params","apply","arguments","onChange","_onChange","presets","input","_input","INPUT_TEXT","wrap","_wrapNode","addChild","wrap_","setStyleClass","WrapInputWPreset","options","get","btnPreset","onPresetDeactivate","clear","deactivate","self","onPresetActivate","build","getProperty","setProperty","getSelectedIndex","pushHistoryState","applyValue","PADDING_PRESET","setOnActive","setOnDeactive","_obj","_key","addEventListener","KEY_UP","_onInputKeyUp","bind","CHANGE","_onInputChange","MOUSE_DOWN","_onInputDragStart","INPUT_SELECT_DRAG","_parent","prototype","Object","create","constructor","e","_keyIsChar","keyCode","dispatchEvent","VALUE_UPDATED","onValueUpdate","data","origin","eventMove","MOUSE_MOVE","eventUp","MOUSE_UP","event","onDrag","onDragFinish","document","removeEventListener","update","module","exports"],"mappings":"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","sourcesContent":["var ObjectComponent = require('../core/ObjectComponent');\r\nvar Node = require('../core/document/Node');\r\nvar CSS = require('../core/document/CSS');\r\nvar Options = require('./Options');\r\nvar ButtonPreset = require('./ButtonPreset');\r\nvar Metric = require('./Metric');\r\n\r\nvar Event_ = require('../core/event/Event'),\r\n    DocumentEvent = require('../core/document/DocumentEvent'),\r\n    NodeEvent = require('../core/document/NodeEvent'),\r\n    ComponentEvent =  require('../core/ComponentEvent');\r\n\r\nvar DEFAULT_PRESET = null;\r\n\r\nfunction StringInput(parent,object,value,params) {\r\n    ObjectComponent.apply(this,arguments);\r\n\r\n    params          = params || {};\r\n    params.onChange = params.onChange || this._onChange;\r\n    params.presets  = params.presets  || DEFAULT_PRESET;\r\n\r\n    this._onChange   = params.onChange;\r\n\r\n    var input = this._input = new Node(Node.INPUT_TEXT);\r\n\r\n    var wrap = this._wrapNode;\r\n\r\n    var presets = params.presets;\r\n    if (!presets) {\r\n        wrap.addChild(input);\r\n    }\r\n    else {\r\n        var wrap_ = new Node();\r\n        wrap_.setStyleClass(CSS.WrapInputWPreset);\r\n\r\n        wrap.addChild(wrap_);\r\n        wrap_.addChild(input);\r\n\r\n        var options = Options.get(),\r\n            btnPreset = new ButtonPreset(this._wrapNode);\r\n\r\n        var onPresetDeactivate = function () {\r\n            options.clear();\r\n            btnPreset.deactivate();\r\n        };\r\n\r\n        var self = this;\r\n        var onPresetActivate = function () {\r\n            options.build(presets,\r\n                input.getProperty('value'),\r\n                input,\r\n                function () {\r\n                    input.setProperty('value', presets[options.getSelectedIndex()]);\r\n                    self.pushHistoryState();\r\n                    self.applyValue();\r\n                },\r\n                onPresetDeactivate,\r\n                Metric.PADDING_PRESET,\r\n                false);\r\n        };\r\n\r\n        btnPreset.setOnActive(onPresetActivate);\r\n        btnPreset.setOnDeactive(onPresetDeactivate)\r\n    }\r\n\r\n    input.setProperty('value',this._obj[this._key]);\r\n\r\n    input.addEventListener(NodeEvent.KEY_UP, this._onInputKeyUp.bind(this));\r\n    input.addEventListener(NodeEvent.CHANGE, this._onInputChange.bind(this));\r\n\r\n    input.addEventListener(NodeEvent.MOUSE_DOWN, this._onInputDragStart.bind(this));\r\n    this.addEventListener(ComponentEvent.INPUT_SELECT_DRAG,this._parent,'onComponentSelectDrag');\r\n}\r\nStringInput.prototype = Object.create(ObjectComponent.prototype);\r\nStringInput.prototype.constructor = StringInput;\r\n\r\nStringInput.prototype._onInputKeyUp = function (e) {\r\n    if (this._keyIsChar(e.keyCode)){\r\n        this.pushHistoryState();\r\n    }\r\n    this.applyValue();\r\n    this._onChange();\r\n};\r\n\r\nStringInput.prototype._onInputChange = function (e) {\r\n    if (this._keyIsChar(e.keyCode)){\r\n        this.pushHistoryState();\r\n    }\r\n    this.applyValue();\r\n};\r\n\r\n//TODO: Finish check\r\nStringInput.prototype._keyIsChar = function (keyCode) {\r\n    return keyCode != 17 &&\r\n        keyCode != 18 &&\r\n        keyCode != 20 &&\r\n        keyCode != 37 &&\r\n        keyCode != 38 &&\r\n        keyCode != 39 &&\r\n        keyCode != 40 &&\r\n        keyCode != 16;\r\n};\r\n\r\n\r\nStringInput.prototype.applyValue = function () {\r\n    this._obj[this._key] = this._input.getProperty('value');\r\n    this.dispatchEvent(new Event_(this, ComponentEvent.VALUE_UPDATED, null));\r\n};\r\n\r\nStringInput.prototype.onValueUpdate = function (e) {\r\n    if (e.data.origin == this)return;\r\n    this._input.setProperty('value', this._obj[this._key]);\r\n};\r\n\r\n//Prevent chrome select drag\r\nStringInput.prototype._onInputDragStart = function () {\r\n    var eventMove = DocumentEvent.MOUSE_MOVE,\r\n        eventUp = DocumentEvent.MOUSE_UP;\r\n\r\n    var event = ComponentEvent.INPUT_SELECT_DRAG;\r\n    var self = this;\r\n    var onDrag = function () {\r\n            self.dispatchEvent(new Event_(this, event, null));\r\n        },\r\n\r\n        onDragFinish = function () {\r\n            self.dispatchEvent(new Event_(this, event, null));\r\n\r\n            document.removeEventListener(eventMove, onDrag, false);\r\n            document.removeEventListener(eventMove, onDragFinish, false);\r\n        };\r\n\r\n    this.dispatchEvent(new Event_(this, event, null));\r\n\r\n    document.addEventListener(eventMove, onDrag, false);\r\n    document.addEventListener(eventUp, onDragFinish, false);\r\n};\r\n\r\nStringInput.prototype.update = function () {\r\n    this.onValueUpdate({ data: {} });\r\n};\r\n\r\nmodule.exports = StringInput;"]},"metadata":{},"sourceType":"script"}